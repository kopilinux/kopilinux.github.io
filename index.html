<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ardi Wijaya - Web Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    <!-- Library untuk QRCode -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
        }
        .feedback-placeholder { /* Digunakan jika belum ada pesan */
            min-height: 24px; /* Sesuaikan dengan tinggi pesan rata-rata */
        }
        /* Style untuk drop zone aktif */
        .dropzone-active {
            border-style: solid;
            border-color: black;
            background-color: #e0e7ff; /* Indigo-100 */
        }
        .preview-img-container {
            width: 100px;
            height: 100px;
            overflow: hidden;
            position: relative;
            display: inline-flex; /* Agar bisa di-wrap */
            margin: 4px;
        }
        .preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .remove-img-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: rgba(0,0,0,0.6);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="bg-white text-zinc-900 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-zinc-900 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <a href="index.html" class="text-3xl font-bold">
                        Ardi Wijaya
                    </a>
                </div>
                <!-- Navbar Desktop -->
                <nav class="hidden md:flex space-x-1">
                    <a href="index.html" class="nav-item px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Beranda</a>
                    <a href="#tools" class="nav-item px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Tools</a>
                    <a href="https://github.com/masardiw" target="_blank" rel="noopener noreferrer" class="nav-item px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">
                        GitHub <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="inline-block ml-1" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
                    </a>
                </nav>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white hover:text-gray-300 focus:outline-none p-2">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>
        </div>
        <nav id="mobile-menu" class="md:hidden hidden bg-zinc-800">
            <a href="index.html" class="nav-item-mobile block px-4 py-3 text-base text-gray-200 hover:bg-gray-700 hover:text-white">Beranda</a>
            <a href="#tools" class="nav-item-mobile block px-4 py-3 text-base text-gray-200 hover:bg-gray-700 hover:text-white">Tools</a>
            <a href="https://github.com/masardiw" target="_blank" rel="noopener noreferrer" class="nav-item-mobile block px-4 py-3 text-base text-gray-200 hover:bg-gray-700 hover:text-white">
                GitHub <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="inline-block ml-1" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
            </a>
        </nav>
    </header>

    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section id="hero" class="text-center py-12">
            <img src="https://placehold.co/120x120/1a1a1a/ffffff?text=AW" alt="[Foto Profil Ardi Wijaya]" class="w-32 h-32 mx-auto rounded-full mb-6 border-4 border-black shadow-lg">
            <h1 class="text-4xl md:text-5xl font-bold mb-3 text-zinc-900">Halo, saya Juli Ardi Wijaya</h1>
            <p class="text-lg md:text-xl text-zinc-700 mb-6">Selamat datang di Kumpulan Web Tools Saya!</p>
            <div class="space-x-4">
                <a href="#tools" class="bg-black text-white px-6 py-3 rounded-md hover:bg-zinc-800 transition-colors duration-150 ease-in-out disabled:opacity-50">Lihat Tools</a>
                <a href="https://github.com/masardiw" target="_blank" rel="noopener noreferrer" class="bg-white text-black border border-black px-6 py-3 rounded-md hover:bg-black hover:text-white transition-colors duration-150 ease-in-out disabled:opacity-50">Kunjungi GitHub</a>
            </div>
        </section>

        <section id="tools" class="py-12 scroll-mt-20">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-10 text-zinc-900">Web Tools</h2>
            <div class="mb-0 border-b border-zinc-300">
                <nav class="-mb-px flex space-x-1 sm:space-x-2 overflow-x-auto pb-px" aria-label="Tabs">
                    <button class="tab-button px-4 py-3 font-semibold text-sm rounded-t-lg whitespace-nowrap transition-colors duration-150 ease-in-out focus:outline-none">QRCode Generator</button>
                    <button class="tab-button px-4 py-3 font-medium text-sm rounded-t-lg whitespace-nowrap transition-colors duration-150 ease-in-out focus:outline-none">Text Formatter</button>
                    <button class="tab-button px-4 py-3 font-medium text-sm rounded-t-lg whitespace-nowrap transition-colors duration-150 ease-in-out focus:outline-none">Watermark Gambar</button>
                    <button class="tab-button px-4 py-3 font-medium text-sm rounded-t-lg whitespace-nowrap transition-colors duration-150 ease-in-out focus:outline-none">Konverter Gambar</button>
                </nav>
            </div>

            <div>
                <!-- QRCode Generator Tab -->
                <div id="qrcode-generator-tab" class="tab-content-panel p-6 border border-zinc-300 border-t-0 rounded-b-lg shadow-lg bg-white">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-zinc-800">Buat QRCode Anda</h3>
                    <div class="max-w-lg mx-auto">
                        <div class="mb-4">
                            <label for="qr-text" class="block text-sm font-medium text-zinc-700 mb-1">Teks atau URL untuk QRCode:</label>
                            <input type="text" id="qr-text" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm" placeholder="Masukkan teks atau URL">
                        </div>
                        <div class="mb-4">
                            <label for="qr-label" class="block text-sm font-medium text-zinc-700 mb-1">Label Opsional (di bawah QRCode):</label>
                            <input type="text" id="qr-label" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm" placeholder="Contoh: Website Saya">
                        </div>
                         <div class="mb-6">
                            <label for="qr-size" class="block text-sm font-medium text-zinc-700 mb-1">Ukuran QRCode (piksel):</label>
                            <input type="number" id="qr-size" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm" value="200" min="50" max="1000">
                        </div>
                        <button id="generate-qr-btn" class="w-full bg-black text-white px-6 py-3 rounded-md hover:bg-zinc-800 transition-colors duration-150 ease-in-out disabled:opacity-50 mb-4">Buat QRCode</button>
                        <div class="min-h-[200px] flex justify-center items-center border border-dashed border-zinc-300 rounded-md mt-4 mb-4 p-4 bg-zinc-50">
                            <canvas id="qrcodeCanvas" class="max-w-full h-auto bg-white"></canvas>
                        </div>
                        <p id="qr-message" class="text-center text-sm py-2 px-3 rounded-md feedback-placeholder"></p>
                        <button id="download-qr-btn" class="w-full bg-white text-black border border-black px-6 py-3 rounded-md hover:bg-black hover:text-white transition-colors duration-150 ease-in-out disabled:opacity-50" disabled>Unduh QRCode (PNG)</button>
                    </div>
                </div>

                <!-- Text Formatter Tab -->
                <div id="text-formatter-tab" class="tab-content-panel hidden p-6 border border-zinc-300 border-t-0 rounded-b-lg shadow-lg bg-white">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-zinc-800">Format Teks Anda</h3>
                    <div class="max-w-xl mx-auto">
                        <div class="mb-4">
                            <label for="text-input" class="block text-sm font-medium text-zinc-700 mb-1">Masukkan Teks:</label>
                            <textarea id="text-input" rows="5" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm" placeholder="Ketik atau tempel teks di sini..."></textarea>
                        </div>
                        <div class="mb-4 flex flex-wrap justify-center gap-2">
                            <button id="btn-uppercase" class="bg-zinc-200 text-zinc-800 px-4 py-2 rounded-md hover:bg-zinc-300 transition-colors duration-150 ease-in-out font-medium">KAPITAL SEMUA</button>
                            <button id="btn-lowercase" class="bg-zinc-200 text-zinc-800 px-4 py-2 rounded-md hover:bg-zinc-300 transition-colors duration-150 ease-in-out font-medium">kecil semua</button>
                            <button id="btn-titlecase" class="bg-zinc-200 text-zinc-800 px-4 py-2 rounded-md hover:bg-zinc-300 transition-colors duration-150 ease-in-out font-medium">Kapital Awal Kata</button>
                        </div>
                        <div class="mb-6">
                            <label for="text-output" class="block text-sm font-medium text-zinc-700 mb-1">Hasil Format:</label>
                            <textarea id="text-output" rows="5" class="mt-1 block w-full px-3 py-2 bg-zinc-50 border border-zinc-400 rounded-md shadow-sm sm:text-sm text-zinc-700" readonly placeholder="Hasil format akan muncul di sini..."></textarea>
                        </div>
                        <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-2 sm:space-y-0">
                            <button id="copy-text-btn" class="flex-1 bg-white text-black border border-black px-6 py-3 rounded-md hover:bg-black hover:text-white transition-colors duration-150 ease-in-out disabled:opacity-50">Salin Hasil</button>
                            <button id="save-text-btn" class="flex-1 bg-white text-black border border-black px-6 py-3 rounded-md hover:bg-black hover:text-white transition-colors duration-150 ease-in-out disabled:opacity-50">Simpan ke .txt</button>
                        </div>
                         <p id="text-formatter-message" class="text-center text-sm py-2 px-3 rounded-md mt-4 feedback-placeholder"></p>
                    </div>
                </div>

                <!-- Image Watermark Tab -->
                <div id="watermark-gambar-tab" class="tab-content-panel hidden p-6 border border-zinc-300 border-t-0 rounded-b-lg shadow-lg bg-white">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-zinc-800">Beri Watermark pada Gambar</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div>
                                <label for="watermark-upload" class="block text-sm font-medium text-zinc-700 mb-1">1. Unggah Gambar Watermark:</label>
                                <input type="file" id="watermark-upload" accept="image/png, image/jpeg" class="mt-1 block w-full text-sm text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-zinc-100 file:text-zinc-700 hover:file:bg-zinc-200 transition-colors">
                                <div id="watermark-preview-container" class="mt-2 w-32 h-32 border border-dashed border-zinc-300 rounded flex items-center justify-center bg-zinc-50 overflow-hidden">
                                    <img id="watermark-preview" src="#" alt="[Pratinjau Watermark]" class="hidden max-w-full max-h-full">
                                    <span id="watermark-preview-placeholder" class="text-xs text-zinc-400">Pratinjau Watermark</span>
                                </div>
                            </div>
                            <div>
                                <label for="watermark-opacity" class="block text-sm font-medium text-zinc-700 mb-1">2. Atur Opasitas Watermark: <span id="opacity-value" class="font-normal">100</span>%</label>
                                <input type="range" id="watermark-opacity" min="0" max="100" value="100" class="w-full h-2 bg-zinc-200 rounded-lg appearance-none cursor-pointer accent-black">
                            </div>
                             <div>
                                <label for="watermark-position" class="block text-sm font-medium text-zinc-700 mb-1">3. Posisi Watermark:</label>
                                <select id="watermark-position" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm">
                                    <option value="bottom-right">Kanan Bawah</option> <option value="bottom-left">Kiri Bawah</option> <option value="top-right">Kanan Atas</option> <option value="top-left">Kiri Atas</option> <option value="center">Tengah</option> <option value="tile">Ubin (Tile)</option>
                                </select>
                            </div>
                            <div>
                                <label for="watermark-scale" class="block text-sm font-medium text-zinc-700 mb-1">4. Skala Watermark (relatif thd gambar target): <span id="scale-value" class="font-normal">20</span>%</label>
                                <input type="range" id="watermark-scale" min="5" max="100" value="20" step="1" class="w-full h-2 bg-zinc-200 rounded-lg appearance-none cursor-pointer accent-black">
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-zinc-700 mb-1">5. Unggah Gambar Target (bisa lebih dari satu):</label>
                                <div id="target-image-dropzone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-zinc-300 border-dashed rounded-md transition-colors">
                                    <div class="space-y-1 text-center">
                                        <svg class="mx-auto h-12 w-12 text-zinc-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                        <div class="flex text-sm text-zinc-600"><label for="target-images-upload-input" class="relative cursor-pointer bg-white rounded-md font-medium text-black hover:text-zinc-700 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-black"><span>Unggah file</span><input id="target-images-upload-input" name="target-images-upload-input" type="file" class="sr-only" multiple accept="image/png, image/jpeg, image/webp"></label><p class="pl-1">atau seret dan lepas</p></div>
                                        <p class="text-xs text-zinc-500">PNG, JPG, JPEG, WEBP hingga 5MB per file</p>
                                        <p class="text-xs text-zinc-500">Anda juga bisa <button type="button" id="paste-target-image-btn" class="font-medium text-black hover:text-zinc-700 underline">tempel dari clipboard</button></p>
                                    </div>
                                </div>
                                <div id="target-images-preview-area" class="mt-4 flex flex-wrap gap-4"></div>
                            </div>
                            <button id="process-watermark-btn" class="w-full bg-black text-white px-6 py-3 rounded-md hover:bg-zinc-800 transition-colors duration-150 ease-in-out disabled:opacity-50" disabled>Beri Watermark & Unduh</button>
                            <p id="watermark-message" class="text-center text-sm py-2 px-3 rounded-md feedback-placeholder"></p>
                            <div id="watermarked-results-area" class="mt-4 space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- Image Converter Tab -->
                <div id="konverter-gambar-tab" class="tab-content-panel hidden p-6 border border-zinc-300 border-t-0 rounded-b-lg shadow-lg bg-white">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-zinc-800">Konversi Format Gambar</h3>
                    <div class="max-w-2xl mx-auto space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-1">1. Unggah Gambar (bisa lebih dari satu):</label>
                            <div id="converter-image-dropzone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-zinc-300 border-dashed rounded-md transition-colors">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-zinc-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                    <div class="flex text-sm text-zinc-600"><label for="converter-images-upload-input" class="relative cursor-pointer bg-white rounded-md font-medium text-black hover:text-zinc-700 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-black"><span>Unggah file</span><input id="converter-images-upload-input" type="file" class="sr-only" multiple accept="image/png, image/jpeg, image/webp, image/gif, image/bmp"></label><p class="pl-1">atau seret dan lepas</p></div>
                                    <p class="text-xs text-zinc-500">PNG, JPG, WEBP, GIF, BMP hingga 5MB per file</p>
                                    <p class="text-xs text-zinc-500">Anda juga bisa <button type="button" id="paste-converter-image-btn" class="font-medium text-black hover:text-zinc-700 underline">tempel dari clipboard</button></p>
                                </div>
                            </div>
                            <div id="converter-images-preview-area" class="mt-4 flex flex-wrap gap-4">
                                <!-- Pratinjau gambar yang akan dikonversi -->
                            </div>
                        </div>

                        <div>
                            <label for="converter-output-format" class="block text-sm font-medium text-zinc-700 mb-1">2. Pilih Format Output:</label>
                            <select id="converter-output-format" class="mt-1 block w-full px-3 py-2 bg-white border border-zinc-400 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-black sm:text-sm">
                                <option value="png">PNG</option>
                                <option value="jpeg">JPG/JPEG</option>
                                <option value="webp">WEBP</option>
                                <!-- <option value="gif">GIF</option> --> <!-- GIF conversion can be tricky with animations -->
                                <!-- <option value="bmp">BMP</option> -->
                            </select>
                        </div>

                        <div id="converter-jpg-quality-container" class="hidden"> <!-- Awalnya disembunyikan -->
                            <label for="converter-jpg-quality" class="block text-sm font-medium text-zinc-700 mb-1">Kualitas JPG: <span id="jpg-quality-value" class="font-normal">90</span>%</label>
                            <input type="range" id="converter-jpg-quality" min="10" max="100" value="90" class="w-full h-2 bg-zinc-200 rounded-lg appearance-none cursor-pointer accent-black">
                        </div>
                        
                        <button id="process-conversion-btn" class="w-full bg-black text-white px-6 py-3 rounded-md hover:bg-zinc-800 transition-colors duration-150 ease-in-out disabled:opacity-50" disabled>Konversi & Unduh</button>
                        <p id="converter-message" class="text-center text-sm py-2 px-3 rounded-md feedback-placeholder"></p>
                        <div id="converted-results-area" class="mt-4 space-y-4">
                            <!-- Hasil gambar terkonversi -->
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <footer class="bg-zinc-900 text-white py-8 text-center">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm">&copy; <span id="currentYear"></span> Ardi Wijaya. Dibuat dengan <span class="text-red-400">&hearts;</span> dan Kode.</p>
            <p class="text-xs mt-1 opacity-75">GitHub Pages: <a href="https://masardiw.github.io" target="_blank" rel="noopener noreferrer" class="hover:underline">masardiw.github.io</a></p>
        </div>
    </footer>

    <script>
        // --- Global Helper Functions ---
        function showMessage(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            if (!el) return;
            el.textContent = message;
            el.className = 'text-center text-sm py-2 px-3 rounded-md mt-2'; 
            if (type === 'success') el.classList.add('bg-green-100', 'text-green-700');
            else if (type === 'error') el.classList.add('bg-red-100', 'text-red-700');
            else el.classList.add('bg-blue-100', 'text-blue-700');
        }

        // --- Mobile Menu ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        }

        // --- Active Nav Link & Smooth Scroll ---
        const allNavItems = [...document.querySelectorAll('header nav.hidden.md\\:flex a.nav-item'), ...document.querySelectorAll('header nav#mobile-menu a.nav-item-mobile')];
        function setActiveNavLink(targetId) {
            allNavItems.forEach(link => {
                link.classList.remove('bg-gray-700', 'text-white', 'font-semibold');
                link.classList.add('text-gray-300');
                if(link.classList.contains('nav-item-mobile')) {
                    link.classList.remove('text-white'); link.classList.add('text-gray-200');
                }
            });
            allNavItems.forEach(link => {
                if (link.getAttribute('href') === targetId || (targetId === 'index.html' && link.getAttribute('href') === 'index.html')) {
                    link.classList.add('bg-gray-700', 'text-white', 'font-semibold');
                    link.classList.remove('text-gray-300', 'text-gray-200');
                }
            });
        }
        document.querySelectorAll('a[href^="#"], a[href="index.html"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (targetId.startsWith("#")) {
                    e.preventDefault();
                    if (mobileMenu && !mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) targetElement.scrollIntoView({ behavior: 'smooth' });
                } else if ((targetId === "index.html" && window.location.pathname.endsWith("/index.html")) || (targetId === "index.html" && window.location.pathname === "/")) {
                    e.preventDefault(); window.scrollTo({ top: 0, behavior: 'smooth' }); setActiveNavLink("index.html");
                }
            });
        });
        function onScroll() {
            let currentSectionId = "index.html"; 
            const headerHeight = document.querySelector('header')?.offsetHeight || 70;
            document.querySelectorAll('main section[id]').forEach(section => {
                if (window.scrollY >= section.offsetTop - headerHeight - 20) currentSectionId = "#" + section.getAttribute('id');
            });
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 50) {
                const sections = document.querySelectorAll('main section[id]');
                if (sections.length > 0) currentSectionId = "#" + sections[sections.length -1].getAttribute('id');
            }
            setActiveNavLink(currentSectionId);
        }
        window.addEventListener('scroll', onScroll);
        window.addEventListener('load', () => {
            onScroll(); 
            const hash = window.location.hash;
            if (hash && hash.startsWith("#")) {
                setActiveNavLink(hash);
                const targetElement = document.querySelector(hash);
                if (targetElement) setTimeout(() => targetElement.scrollIntoView({ behavior: 'smooth' }), 100);
            } else { setActiveNavLink("index.html"); }
        });

        // --- Footer Year ---
        const currentYearElement = document.getElementById('currentYear');
        if (currentYearElement) currentYearElement.textContent = new Date().getFullYear();

        // --- Tab Functionality ---
        const tabButtonElements = document.querySelectorAll('.tab-button');
        const activeTabClasses = ['bg-black', 'text-white', 'font-semibold'];
        const inactiveTabClasses = ['text-zinc-600', 'hover:text-black', 'hover:bg-zinc-100', 'font-medium', 'bg-zinc-50'];

        function activateTab(tabButtonToActivate) {
            tabButtonElements.forEach(btn => {
                btn.classList.remove(...activeTabClasses); btn.classList.add(...inactiveTabClasses);
                const panelId = btn.textContent.trim().toLowerCase().replace(/\s+/g, '-') + '-tab';
                const panel = document.getElementById(panelId);
                if (panel) panel.classList.add('hidden');
            });
            tabButtonToActivate.classList.add(...activeTabClasses);
            tabButtonToActivate.classList.remove(...inactiveTabClasses);
            const activePanelId = tabButtonToActivate.textContent.trim().toLowerCase().replace(/\s+/g, '-') + '-tab';
            const activePanel = document.getElementById(activePanelId);
            if (activePanel) activePanel.classList.remove('hidden');
        }
        tabButtonElements.forEach((button, index) => {
            button.addEventListener('click', () => activateTab(button));
            if (index === 0) activateTab(button);
            else {
                const panelId = button.textContent.trim().toLowerCase().replace(/\s+/g, '-') + '-tab';
                const panel = document.getElementById(panelId);
                if (panel) panel.classList.add('hidden');
            }
        });

        // --- QRCode Generator (Existing Code) ---
        const qrTextInput = document.getElementById('qr-text');
        const qrLabelInput = document.getElementById('qr-label');
        const qrSizeInput = document.getElementById('qr-size');
        const generateQrBtn = document.getElementById('generate-qr-btn');
        const downloadQrBtn = document.getElementById('download-qr-btn');
        const qrcodeCanvas = document.getElementById('qrcodeCanvas');
        let qrCtx = qrcodeCanvas ? qrcodeCanvas.getContext('2d') : null;
        let generatedQRDataUrl = null;

        if (generateQrBtn) {
            generateQrBtn.addEventListener('click', async () => {
                if (!qrTextInput || !qrLabelInput || !qrSizeInput || !qrCtx || !qrcodeCanvas) return;
                const text = qrTextInput.value.trim(); const label = qrLabelInput.value.trim(); const size = parseInt(qrSizeInput.value) || 200;
                if (!text) { showMessage('qr-message', 'Masukkan teks atau URL.', 'error'); downloadQrBtn.disabled = true; generatedQRDataUrl = null; qrCtx.clearRect(0, 0, qrcodeCanvas.width, qrcodeCanvas.height); return; }
                showMessage('qr-message', 'Membuat QRCode...', 'info');
                try {
                    const tempCanvas = document.createElement('canvas'); await QRCode.toCanvas(tempCanvas, text, { width: size, margin: 2, errorCorrectionLevel: 'H' });
                    const qrImageWidth = tempCanvas.width; const qrImageHeight = tempCanvas.height;
                    let totalHeight = qrImageHeight; const labelHeight = label ? 30 : 0; const labelPadding = 10;
                    if (label) totalHeight += labelHeight + labelPadding;
                    qrcodeCanvas.width = qrImageWidth; qrcodeCanvas.height = totalHeight;
                    qrCtx.fillStyle = '#ffffff'; qrCtx.fillRect(0, 0, qrcodeCanvas.width, qrcodeCanvas.height); qrCtx.drawImage(tempCanvas, 0, 0);
                    if (label) { qrCtx.fillStyle = '#000000'; qrCtx.font = 'bold 16px Space Grotesk'; qrCtx.textAlign = 'center'; qrCtx.fillText(label, qrImageWidth / 2, qrImageHeight + labelPadding + (labelHeight / 2) - 2); }
                    generatedQRDataUrl = qrcodeCanvas.toDataURL('image/png'); downloadQrBtn.disabled = false; showMessage('qr-message', 'QRCode berhasil dibuat!', 'success');
                } catch (err) { console.error('Error QR:', err); showMessage('qr-message', 'Gagal membuat QRCode.', 'error'); downloadQrBtn.disabled = true; generatedQRDataUrl = null; qrCtx.clearRect(0, 0, qrcodeCanvas.width, qrcodeCanvas.height); }
            });
        }
        if (downloadQrBtn) {
            downloadQrBtn.addEventListener('click', () => {
                if (generatedQRDataUrl) {
                    const link = document.createElement('a'); link.download = `qrcode_${(qrTextInput?.value.substring(0,20).replace(/\s/g,'_')) || 'ArdiWijaya'}.png`;
                    link.href = generatedQRDataUrl; document.body.appendChild(link); link.click(); document.body.removeChild(link);
                    showMessage('qr-message', 'QRCode diunduh.', 'success');
                } else { showMessage('qr-message', 'Buat QRCode dulu.', 'error'); }
            });
        }

        // --- Text Formatter (Existing Code) ---
        const textInput = document.getElementById('text-input');
        const textOutput = document.getElementById('text-output');
        const btnUppercase = document.getElementById('btn-uppercase');
        const btnLowercase = document.getElementById('btn-lowercase');
        const btnTitlecase = document.getElementById('btn-titlecase');
        const copyTextBtn = document.getElementById('copy-text-btn');
        const saveTextBtn = document.getElementById('save-text-btn');

        function formatText(type) {
            if (!textInput || !textOutput) return; const inputText = textInput.value;
            if (!inputText.trim()) { showMessage('text-formatter-message', 'Masukkan teks.', 'error'); return; }
            let ft = ''; switch (type) { case 'uppercase': ft = inputText.toUpperCase(); break; case 'lowercase': ft = inputText.toLowerCase(); break; case 'titlecase': ft = inputText.toLowerCase().replace(/\b\w/g, char => char.toUpperCase()); break; }
            textOutput.value = ft; showMessage('text-formatter-message', 'Teks diformat!', 'success');
        }
        if (btnUppercase) btnUppercase.addEventListener('click', () => formatText('uppercase'));
        if (btnLowercase) btnLowercase.addEventListener('click', () => formatText('lowercase'));
        if (btnTitlecase) btnTitlecase.addEventListener('click', () => formatText('titlecase'));
        if (copyTextBtn) {
            copyTextBtn.addEventListener('click', () => {
                if (!textOutput) return; const ot = textOutput.value; if (!ot.trim()) { showMessage('text-formatter-message', 'Tidak ada teks.', 'error'); return; }
                try { const ta = document.createElement("textarea"); ta.value = ot; ta.style.position = "fixed"; document.body.appendChild(ta); ta.focus(); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showMessage('text-formatter-message', 'Teks disalin!', 'success');
                } catch (err) { console.error('Gagal salin:', err); showMessage('text-formatter-message', 'Gagal menyalin.', 'error'); }
            });
        }
        if (saveTextBtn) {
            saveTextBtn.addEventListener('click', () => {
                if (!textOutput) return; const ot = textOutput.value; if (!ot.trim()) { showMessage('text-formatter-message', 'Tidak ada teks.', 'error'); return; }
                try { const blob = new Blob([ot],{type:'text/plain;charset=utf-8'}); const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download='formatted_text_ArdiWijaya.txt'; document.body.appendChild(link);link.click();document.body.removeChild(link); URL.revokeObjectURL(link.href); showMessage('text-formatter-message', 'Teks disimpan!', 'success');
                } catch (err) { console.error('Gagal simpan:', err); showMessage('text-formatter-message', 'Gagal menyimpan.', 'error'); }
            });
        }

        // --- Image Watermark Tool (Existing Code) ---
        const watermarkUpload = document.getElementById('watermark-upload');
        const watermarkPreview = document.getElementById('watermark-preview');
        const watermarkPreviewPlaceholder = document.getElementById('watermark-preview-placeholder');
        const watermarkOpacitySlider = document.getElementById('watermark-opacity');
        const opacityValueDisplay = document.getElementById('opacity-value');
        const watermarkPositionSelect = document.getElementById('watermark-position');
        const watermarkScaleSlider = document.getElementById('watermark-scale');
        const scaleValueDisplay = document.getElementById('scale-value');
        const targetImageDropzone = document.getElementById('target-image-dropzone');
        const targetImagesUploadInput = document.getElementById('target-images-upload-input');
        const targetImagesPreviewArea = document.getElementById('target-images-preview-area');
        const pasteTargetImageBtn = document.getElementById('paste-target-image-btn');
        const processWatermarkBtn = document.getElementById('process-watermark-btn');
        const watermarkedResultsArea = document.getElementById('watermarked-results-area');
        let watermarkImage = null; let watermarkOpacity = 1; let watermarkPosition = 'bottom-right'; let watermarkScale = 0.2; let targetImages = [];

        function updateWatermarkProcessButtonState() { if (processWatermarkBtn) processWatermarkBtn.disabled = !(watermarkImage && targetImages.length > 0); }
        if (watermarkUpload) {
            watermarkUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        watermarkImage = new Image(); watermarkImage.onload = () => updateWatermarkProcessButtonState(); watermarkImage.src = e.target.result;
                        if (watermarkPreview) { watermarkPreview.src = e.target.result; watermarkPreview.classList.remove('hidden'); }
                        if (watermarkPreviewPlaceholder) watermarkPreviewPlaceholder.classList.add('hidden');
                        showMessage('watermark-message', 'Watermark dimuat.', 'success');
                    }; reader.readAsDataURL(file);
                } else {
                    watermarkImage = null; if (watermarkPreview) { watermarkPreview.src = "#"; watermarkPreview.classList.add('hidden'); }
                    if (watermarkPreviewPlaceholder) watermarkPreviewPlaceholder.classList.remove('hidden');
                    showMessage('watermark-message', 'Pilih file gambar.', 'error'); updateWatermarkProcessButtonState();
                }
            });
        }
        if (watermarkOpacitySlider && opacityValueDisplay) { watermarkOpacitySlider.addEventListener('input', (event) => { watermarkOpacity = parseInt(event.target.value) / 100; opacityValueDisplay.textContent = event.target.value; });}
        if (watermarkScaleSlider && scaleValueDisplay) { watermarkScaleSlider.addEventListener('input', (event) => { watermarkScale = parseInt(event.target.value) / 100; scaleValueDisplay.textContent = event.target.value; });}
        if (watermarkPositionSelect) { watermarkPositionSelect.addEventListener('change', (event) => { watermarkPosition = event.target.value; });}
        
        function addWatermarkTargetImage(file, source = 'upload') {
            if (!file.type.startsWith('image/')) { showMessage('watermark-message', `File ${file.name} bukan gambar.`, 'error'); return; }
            if (file.size > 5 * 1024 * 1024) { showMessage('watermark-message', `File ${file.name} > 5MB.`, 'error'); return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageId = `target-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;
                targetImages.push({ id: imageId, file: file, dataUrl: e.target.result, name: file.name });
                const pContainer = document.createElement('div'); pContainer.className = 'preview-img-container border border-zinc-300 rounded-md shadow-sm'; pContainer.id = `container-${imageId}`;
                const img = document.createElement('img'); img.src = e.target.result; img.alt = `[Pratinjau ${file.name}]`; img.className = 'preview-img';
                const rmvBtn = document.createElement('button'); rmvBtn.className = 'remove-img-btn'; rmvBtn.innerHTML = '&times;';
                rmvBtn.onclick = () => { targetImages = targetImages.filter(imgObj => imgObj.id !== imageId); document.getElementById(`container-${imageId}`)?.remove(); updateWatermarkProcessButtonState(); };
                pContainer.appendChild(img); pContainer.appendChild(rmvBtn);
                if(targetImagesPreviewArea) targetImagesPreviewArea.appendChild(pContainer);
                updateWatermarkProcessButtonState();
            }; reader.readAsDataURL(file);
        }
        if (targetImagesUploadInput) { targetImagesUploadInput.addEventListener('change', (event) => { Array.from(event.target.files).forEach(f => addWatermarkTargetImage(f)); event.target.value = null; });}
        if (targetImageDropzone) {
            targetImageDropzone.addEventListener('dragover', (event) => { event.preventDefault(); targetImageDropzone.classList.add('dropzone-active'); });
            targetImageDropzone.addEventListener('dragleave', () => targetImageDropzone.classList.remove('dropzone-active'));
            targetImageDropzone.addEventListener('drop', (event) => { event.preventDefault(); targetImageDropzone.classList.remove('dropzone-active'); if (event.dataTransfer.files) Array.from(event.dataTransfer.files).forEach(f => addWatermarkTargetImage(f, 'drop')); });
        }
        if (pasteTargetImageBtn) {
            pasteTargetImageBtn.addEventListener('click', async () => {
                 try {
                    const clipboardItems = await navigator.clipboard.read(); let found = false;
                    for (const item of clipboardItems) { for (const type of item.types) { if (type.startsWith("image/")) { const blob = await item.getType(type); const fileName = `clipboard-${Date.now()}.${blob.type.split('/')[1]||'png'}`; addWatermarkTargetImage(new File([blob],fileName,{type:blob.type}), 'paste'); found=true;}}}
                    if(found) showMessage('watermark-message', 'Gambar dari clipboard ditambah.', 'success'); else showMessage('watermark-message', 'Tidak ada gambar di clipboard.', 'info');
                } catch (err) { console.error("Error paste:", err); showMessage('watermark-message', 'Gagal tempel dari clipboard.', 'error');}
            });
        }
        if (processWatermarkBtn) {
            processWatermarkBtn.addEventListener('click', async () => {
                if (!watermarkImage || targetImages.length === 0) { showMessage('watermark-message', 'Unggah watermark & gambar target.', 'error'); return; }
                processWatermarkBtn.disabled = true; processWatermarkBtn.textContent = 'Memproses...';
                if(watermarkedResultsArea) watermarkedResultsArea.innerHTML = '<p class="text-center text-zinc-500">Memproses...</p>';
                let processedCount = 0;
                for (const target of targetImages) {
                    const targetImg = new Image();
                    targetImg.onload = () => {
                        const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); canvas.width = targetImg.naturalWidth; canvas.height = targetImg.naturalHeight; ctx.drawImage(targetImg, 0, 0);
                        const wmNW = watermarkImage.naturalWidth; const wmNH = watermarkImage.naturalHeight; let wmDW, wmDH;
                        wmDW = canvas.width * watermarkScale; wmDH = (wmNH / wmNW) * wmDW;
                        if (wmDH > canvas.height * 0.9) { wmDH = canvas.height * 0.9 * watermarkScale; wmDW = (wmNW / wmNH) * wmDH; }
                        let pX, pY; const pad = canvas.width * 0.02;
                        switch (watermarkPosition) {
                            case 'top-left': pX=pad; pY=pad; break; case 'top-right': pX=canvas.width-wmDW-pad; pY=pad; break;
                            case 'bottom-left': pX=pad; pY=canvas.height-wmDH-pad; break; case 'center': pX=(canvas.width-wmDW)/2; pY=(canvas.height-wmDH)/2; break;
                            case 'tile': break; default: pX=canvas.width-wmDW-pad; pY=canvas.height-wmDH-pad; break;
                        }
                        ctx.globalAlpha = watermarkOpacity;
                        if (watermarkPosition === 'tile') {
                            const pCan = document.createElement('canvas'); const pCtx = pCan.getContext('2d'); let tileW = canvas.width*0.25; let tileH=(wmNH/wmNW)*tileW;
                            pCan.width=tileW+pad*2; pCan.height=tileH+pad*2; pCtx.drawImage(watermarkImage,pad,pad,tileW,tileH); ctx.fillStyle=ctx.createPattern(pCan,'repeat'); ctx.fillRect(0,0,canvas.width,canvas.height);
                        } else { ctx.drawImage(watermarkImage, pX, pY, wmDW, wmDH); }
                        ctx.globalAlpha = 1.0;
                        const resUrl = canvas.toDataURL(target.file.type==='image/png'?'image/png':'image/jpeg');
                        if (processedCount === 0 && watermarkedResultsArea) watermarkedResultsArea.innerHTML = '';
                        const resCont = document.createElement('div'); resCont.className='p-4 border border-zinc-200 rounded-md shadow-sm bg-zinc-50';
                        const resImg = document.createElement('img'); resImg.src=resUrl; resImg.alt=`[Hasil ${target.name}]`; resImg.className='max-w-full h-auto rounded mb-2 mx-auto block max-h-60 object-contain';
                        const dlLink = document.createElement('a'); dlLink.href=resUrl; dlLink.download=`watermarked_${target.name}`; dlLink.className='block w-full text-center bg-black text-white px-4 py-2 rounded-md hover:bg-zinc-800 transition-colors text-sm'; dlLink.textContent=`Unduh ${target.name}`;
                        resCont.appendChild(resImg); resCont.appendChild(dlLink); if(watermarkedResultsArea) watermarkedResultsArea.appendChild(resCont);
                        processedCount++; if (processedCount === targetImages.length) { processWatermarkBtn.disabled = false; processWatermarkBtn.textContent = 'Beri Watermark & Unduh'; showMessage('watermark-message', 'Semua gambar diproses!', 'success'); }
                    };
                    targetImg.onerror = () => { console.error(`Gagal muat: ${target.name}`); showMessage('watermark-message', `Gagal muat ${target.name}`, 'error'); processedCount++; if (processedCount === targetImages.length) { processWatermarkBtn.disabled = false; processWatermarkBtn.textContent = 'Beri Watermark & Unduh'; }};
                    targetImg.src = target.dataUrl;
                }
            });
        }
        
        // --- Image Converter Tool ---
        const converterImageDropzone = document.getElementById('converter-image-dropzone');
        const converterImagesUploadInput = document.getElementById('converter-images-upload-input');
        const converterImagesPreviewArea = document.getElementById('converter-images-preview-area');
        const pasteConverterImageBtn = document.getElementById('paste-converter-image-btn');
        const converterOutputFormatSelect = document.getElementById('converter-output-format');
        const converterJpgQualityContainer = document.getElementById('converter-jpg-quality-container');
        const converterJpgQualitySlider = document.getElementById('converter-jpg-quality');
        const jpgQualityValueDisplay = document.getElementById('jpg-quality-value');
        const processConversionBtn = document.getElementById('process-conversion-btn');
        const convertedResultsArea = document.getElementById('converted-results-area');

        let converterTargetImages = []; // Array for images to be converted

        function updateConversionProcessButtonState() {
            if (processConversionBtn) {
                processConversionBtn.disabled = !(converterTargetImages.length > 0);
            }
        }

        function addConverterTargetImage(file, source = 'upload') {
            if (!file.type.startsWith('image/')) {
                showMessage('converter-message', `File ${file.name} bukan gambar.`, 'error');
                return;
            }
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                 showMessage('converter-message', `File ${file.name} terlalu besar (maks 5MB).`, 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const imageId = `converter-target-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;
                // Simpan file asli untuk konversi, dan dataUrl untuk preview
                converterTargetImages.push({ id: imageId, file: file, dataUrl: e.target.result, name: file.name });
                
                const previewContainer = document.createElement('div');
                previewContainer.className = 'preview-img-container border border-zinc-300 rounded-md shadow-sm';
                previewContainer.id = `container-${imageId}`;

                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = `[Pratinjau ${file.name}]`;
                img.className = 'preview-img';
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-img-btn';
                removeBtn.innerHTML = '&times;';
                removeBtn.onclick = () => {
                    converterTargetImages = converterTargetImages.filter(imgObj => imgObj.id !== imageId);
                    document.getElementById(`container-${imageId}`)?.remove();
                    updateConversionProcessButtonState();
                };

                previewContainer.appendChild(img);
                previewContainer.appendChild(removeBtn);
                if(converterImagesPreviewArea) converterImagesPreviewArea.appendChild(previewContainer);
                updateConversionProcessButtonState();
            };
            reader.readAsDataURL(file);
        }

        if (converterImagesUploadInput) {
            converterImagesUploadInput.addEventListener('change', (event) => {
                Array.from(event.target.files).forEach(f => addConverterTargetImage(f));
                event.target.value = null; // Reset input
            });
        }

        if (converterImageDropzone) {
            converterImageDropzone.addEventListener('dragover', (event) => { event.preventDefault(); converterImageDropzone.classList.add('dropzone-active'); });
            converterImageDropzone.addEventListener('dragleave', () => converterImageDropzone.classList.remove('dropzone-active'));
            converterImageDropzone.addEventListener('drop', (event) => {
                event.preventDefault(); converterImageDropzone.classList.remove('dropzone-active');
                if (event.dataTransfer.files) Array.from(event.dataTransfer.files).forEach(f => addConverterTargetImage(f, 'drop'));
            });
        }

        if (pasteConverterImageBtn) {
            pasteConverterImageBtn.addEventListener('click', async () => {
                 try {
                    const clipboardItems = await navigator.clipboard.read(); let found = false;
                    for (const item of clipboardItems) { for (const type of item.types) { if (type.startsWith("image/")) { const blob = await item.getType(type); const fileName = `clipboard-${Date.now()}.${blob.type.split('/')[1]||'png'}`; addConverterTargetImage(new File([blob],fileName,{type:blob.type}), 'paste'); found=true;}}}
                    if(found) showMessage('converter-message', 'Gambar dari clipboard ditambah.', 'success'); else showMessage('converter-message', 'Tidak ada gambar di clipboard.', 'info');
                } catch (err) { console.error("Error paste converter:", err); showMessage('converter-message', 'Gagal tempel dari clipboard.', 'error');}
            });
        }
        
        if (converterOutputFormatSelect && converterJpgQualityContainer) {
            converterOutputFormatSelect.addEventListener('change', (event) => {
                if (event.target.value === 'jpeg') {
                    converterJpgQualityContainer.classList.remove('hidden');
                } else {
                    converterJpgQualityContainer.classList.add('hidden');
                }
            });
        }
        if (converterJpgQualitySlider && jpgQualityValueDisplay) {
            converterJpgQualitySlider.addEventListener('input', (event) => {
                jpgQualityValueDisplay.textContent = event.target.value;
            });
        }

        if (processConversionBtn) {
            processConversionBtn.addEventListener('click', async () => {
                if (converterTargetImages.length === 0) {
                    showMessage('converter-message', 'Unggah minimal satu gambar untuk dikonversi.', 'error');
                    return;
                }
                processConversionBtn.disabled = true;
                processConversionBtn.textContent = 'Mengkonversi...';
                if(convertedResultsArea) convertedResultsArea.innerHTML = '<p class="text-center text-zinc-500">Sedang mengkonversi gambar...</p>';

                const outputFormat = converterOutputFormatSelect ? converterOutputFormatSelect.value : 'png';
                const jpgQuality = converterJpgQualitySlider ? parseInt(converterJpgQualitySlider.value) / 100 : 0.9;
                let mimeType = `image/${outputFormat}`;
                if (outputFormat === 'jpg') mimeType = 'image/jpeg'; // common practice

                let processedCount = 0;
                for (const imgObject of converterTargetImages) {
                    const originalImage = new Image();
                    originalImage.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = originalImage.naturalWidth;
                        canvas.height = originalImage.naturalHeight;
                        
                        // Jika format asli adalah PNG dan outputnya JPG, kita perlu mengisi background putih
                        // karena JPG tidak mendukung transparansi.
                        if ((imgObject.file.type === 'image/png' || imgObject.file.type === 'image/webp') && outputFormat === 'jpeg') {
                            ctx.fillStyle = '#FFFFFF'; // Putih
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                        }
                        
                        ctx.drawImage(originalImage, 0, 0);

                        let convertedDataUrl;
                        if (outputFormat === 'jpeg') {
                            convertedDataUrl = canvas.toDataURL(mimeType, jpgQuality);
                        } else {
                            convertedDataUrl = canvas.toDataURL(mimeType);
                        }
                        
                        if (processedCount === 0 && convertedResultsArea) convertedResultsArea.innerHTML = ''; 

                        const resultContainer = document.createElement('div');
                        resultContainer.className = 'p-4 border border-zinc-200 rounded-md shadow-sm bg-zinc-50';
                        
                        const resultImg = document.createElement('img');
                        resultImg.src = convertedDataUrl;
                        resultImg.alt = `[Hasil Konversi ${imgObject.name}]`;
                        resultImg.className = 'max-w-full h-auto rounded mb-2 mx-auto block max-h-60 object-contain';
                        
                        const originalFileNameParts = imgObject.name.split('.');
                        originalFileNameParts.pop(); // Hapus ekstensi lama
                        const baseName = originalFileNameParts.join('.');
                        const newFileName = `${baseName}.${outputFormat}`;

                        const downloadLink = document.createElement('a');
                        downloadLink.href = convertedDataUrl;
                        downloadLink.download = newFileName;
                        downloadLink.className = 'block w-full text-center bg-black text-white px-4 py-2 rounded-md hover:bg-zinc-800 transition-colors text-sm';
                        downloadLink.textContent = `Unduh ${newFileName}`;
                        
                        resultContainer.appendChild(resultImg);
                        resultContainer.appendChild(downloadLink);
                        if(convertedResultsArea) convertedResultsArea.appendChild(resultContainer);
                        
                        processedCount++;
                        if (processedCount === converterTargetImages.length) {
                            processConversionBtn.disabled = false;
                            processConversionBtn.textContent = 'Konversi & Unduh';
                            showMessage('converter-message', 'Semua gambar berhasil dikonversi!', 'success');
                        }
                    };
                    originalImage.onerror = () => {
                         console.error(`Gagal memuat gambar untuk konversi: ${imgObject.name}`);
                         showMessage('converter-message', `Gagal memuat gambar: ${imgObject.name}`, 'error');
                         processedCount++;
                         if (processedCount === converterTargetImages.length) {
                            processConversionBtn.disabled = false;
                            processConversionBtn.textContent = 'Konversi & Unduh';
                         }
                    };
                    originalImage.src = imgObject.dataUrl; // Gunakan dataUrl untuk menggambar ke canvas
                }
            });
        }

    </script>
</body>
</html>
